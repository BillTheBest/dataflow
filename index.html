<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Dataflow graph editor</title>
  <link rel="stylesheet" href="dataflow.css">
</head>

<body>
  <div id="app">
    <!-- ALL YOUR CONTENT HERE -->
  </div>

  <!-- Third-Party Libraries (Order matters) -->
  <script src="libs/jquery.js"></script>
  <script src="libs/jquery-ui.js"></script>
  <script src="libs/underscore.js"></script>
  <script src="libs/backbone.js"></script>
  <script src="libs/backbone.collectionview.js"></script>

  <!-- Application core (Order matters) -->
  <script src="src/dataflow.js"></script>

  <!-- Modules (Order does not matter) -->
  <script src="src/modules/graph.js"></script>
  <script src="src/modules/node.js"></script>
  <script src="src/modules/input.js"></script>
  <script src="src/modules/output.js"></script>
  <script src="src/modules/edge.js"></script>

  <script src="src/modules/graph-view.js"></script>
  <script src="src/modules/node-view.js"></script>
  <script src="src/modules/input-view.js"></script>
  <script src="src/modules/output-view.js"></script>
  <script src="src/modules/edge-view.js"></script>

  <!-- Testing -->
  <form id="add">
    <input id="nodeid" type="text" placeholder="node id" value="3" />
    <input id="addnode" type="submit" value="add node" />
  </form>
  <textarea id="code" style="width: 230px; height: 475px;"></textarea>
  <script>
    $(function($) {

      // Load test graph
      Dataflow.loadGraph({"nodes":[{"id":1,"x":250,"y":100},{"id":2,"x":500,"y":100}],"edges":[{"source":1,"target":2}]});

      // On change update code view
      Dataflow.graph.on("change", function(){
        $("#code").val( JSON.stringify(Dataflow.graph.toJSON(), null, "  ") );
      });
      Dataflow.graph.trigger("change");

      // Add nodes to test graph
      var Node = Dataflow.module("node");
      $("#add").submit(function(){
        var id = $('#nodeid').val();
        var newNode = new Node.Model({
          "id": id
        });
        Dataflow.graph.get('nodes').add(newNode);
        $('#nodeid').val(id+"a");
        return false;
      });
    });
  </script>

</body>
</html>
